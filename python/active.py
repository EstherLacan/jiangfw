#coding=utf-8
import MySQLdb
import mymail
import time
import datetime
import sys

reload(sys)
sys.setdefaultencoding('utf-8')

class ActiveUser(object):
	"""docstring for ActiveUser"""
	def __init__(self):
		super(ActiveUser, self).__init__()
		conn= MySQLdb.connect(
				host='localhost',
				port = 3306,
				user='root',
				passwd='root',
				db ='mhealth_business',
				charset='utf8'
				)
		self.conn = conn


	def createHtmlContent(self):
		"""
		创建html邮件内容
		"""
		content = '''
		<html>
		<body>
		<h4>%s</h4>
		<table border="1">
		<tr>
		<th>姓名</th>
		<th>性别</th>
		<th>电话</th>
		<th>邮箱</th>
		<th>地址</th>
		<th>登录时间</th>
		<th>测量次数</th>
		</tr>
		%s
		</table>
		</body>
		</html>
		'''
		return content;


	def createSQL(self):
		sql= '''
		SELECT
			r.User_ID,
			u.User_FullName,
			CASE u.User_Sex 
					WHEN 1 THEN '男'
					WHEN 2 THEN '女'
					ELSE '未知'
		END as User_Sex,
			u.User_Phone,
			u.User_Mail,
			u.User_Address,
			from_unixtime(File_Start_Time,'%Y-%m-%d') datetime,
		count(1) as '测量次数'
		FROM
			m_ecg_record_r r
		INNER JOIN m_ecg_user u ON r.User_ID = u.User_ID
		WHERE
			from_unixtime(File_Start_Time, '%Y-%m-%d') = DATE_FORMAT(
				date_sub(now(), INTERVAL 1 DAY),
				'%Y-%m-%d'
			) and r.User_ID in(71876,50134,56112,65956,49828,52828,51298,56668,64386,58006,53822,57194,32165,46472,63966,58780,56540,67470,58650,50690,46506,48836,35978,66926,57956,46128,51254,45016,55158,65638,66244,61360,47258,48356,57804,64808,67020,71242,61912,66442,66252,65976,58492,60470,38958,44401,71728,65664,56062,55492,52098,49670,51472,51054,67364,63834,62180,71326,68366,46168,33996,49836,57192,47756,56508,59016,52824,66342,49490,46654,48924,68496,63180,74072,64092,43875,56728,57196,33078,55622,71102,55172,58764,50316,49804,63124,72646,60972,65984,48728,43949,41917,59940,52130,51566,55596,33991,74348,66660,61728,74808,63056,72896,46206,55142,59892,46318,53344,57846,48544,67344,46872,61852,52528,37672,47684,62168,62508,61096,50166,64950,53328,49106,46364,52086,71558,68362,62862,56252,56120,65832,69646,61072,46678,63718,66152,59246,55966,69924,56498,58204,59410,69496,47624,66246,67452,62594,50818,47368,48814,51058,62492,68998,50854,62324,63228,69830,67026,51690,67830,60574,50620,54148,46624,63172,56418,64540,68572,52706,46194,57854,44469,52078,52464,52628,55700,53334,73904,49280,67844,50932,51912,65856,69626,67162,65706,70054,46904,71642,69038,40226,60986,50120,65718,45176,52558,72628,68594,70896,56766,65714,73078,47418,64924,67360,64222,72280,63144,66444,67724,62038,74230,59120,65286,47236,65992,42011,52040,43041,66992,47200,72870,60688,56416,43231,65332,58188,59668,51928,67906,67648,61410,63956,65284,70300,64558,68990,52434,52518,60218,64580,73900,52938,53094,66008,54140,66248,68226,64678,66374,64866,67372,51722,52126,52380,50566,68258,71300,47066,58046,62292,66938,65878,47156,39804,40384,67126,70368,66580,57680,66590,51044,64248,64982,51894,65452,74820,51734,52514,69378,66282,70792,50608,56274,68788,66562,62912,65572,60782,65854,73844,73314,46926,73944,57916,73494,57648,67890,50680,73704,65288,63712,52946,33047,47476,56792,58642,71218,61468,68646,62988,63426,68002,44951,45686,65152,71268,71958,64026,53456,68578,64392,70642,73718,70070,68310,67790,65836,54498,58502,74610,72304,70210,63862,37486,57970,54942,49786,35458,53378,66990,46348,70030,68120,65314,54242,65808,59824,58636,71984,69100,70502,68510,57110,70588,72112,72544,60592,67946,42403,65050,54850,74632,55100,60008,50820,60664,72018,68754,68838,71938,66598,66386,41150,56406,66020,65370,69180,46594,57366,57488,67672,69246,69354,73084,71562,72728,58620,57162,64472,57312,72578,65296,65508,47244,73742,43957,71406,64326,68372,67430,70238,63064,72840,60686,64964,66022,65372,64448,71036,62838,58960,72574,73728,67576,67598,66270,74324,66974,64460,72548,68620,72576,71092,69294,73740,59502,70326,74844,63796,67248,63870,70262,72204,58066,71790,54026,60800,72720,66944,61164,71670,61884,72284,45062,66286,55166,52510,32068,34921,50694,47220,69932,59728,59780,52088,63832,65268,59282,63138,70094,51248,53954,67956,44959,59950,74658,55922,59412,68708,71336,73778,66954,68022,64524,67044,69064,59186,36820,68464,56236,69736,71180,70146,68792,67814,68048,46244,74372,61546,64064,69886,64118,73362,68714,63292,72694,68218,64296,68970,57048,61242,58904,60302,55882,39760,73350,40980,64142,68332,54468,48742,62450,66742,55030,52154,61304,71668,65910,50776,66854,61874,69482,51060,64960,68966,68352,72970,71446,57246,74920,66108,73026,67030,62024,41340,56350,64946,54046,64292,59768,48660,65810,68772,58600,65382,64360,66746,68034,68386,73018,67850,50562,68882,64716,51242,60836,66460,63490,67794,45098,67244,73540,53076,63920,46692,67084,68484,64120,68928,66680,66028,66234,64300,58534,72288,56830,68846,57554,69270,74732,61832,57894,72622,59526,64204,70108,68974,63522,72100,66292,55212,60118,66332,70472,73592,72866,72436,72656,54146,66238,58276,71826,65150,58734,66306,62914,65512,56118,64878,56602,67990,56754,67404,71424,49048,58762,65180,69812,67036,69652,66164,61872,65294,56262,66206,54098,74272,68960,65082,73816,61162,69388,60028,73566,69296,67728,68922,67938,72664,73634,59678,43657,73650,60946,54584,67618,45135,69578,66540,61456,62832,71736,60580,50780,73358,67336,59558,67770,69150,68000,66946,73812,62502,67824,65178,55230,66110,72554,57710,61700,73320,69876,66174,67082,71526,68478,69290,70690,70718,51344,63252,68742,72248,74598,58604,66738,73442,67422,67210,60088,46326,61438,66566,52572,71688,58976,73304,61712,53228,66862,68294,66410,58080,69714,65034,58206,67180,67426,65628,68826,58810,55192,68858,68886,66166,37652,67078,70676,68486,71994,71554,70516,63272,72906,60846,69928,48636,58498,52114,55054,62584,58830,71454,64546,57398,67514,59300,53424,69676,68476,74490,69902,63250,66470,71412,54832,67208,70386,67446,52204,61310,57258,65870,68852,70228,32313,72816,69266,72618,68918,59492,68926,67354,65562,72040,68530,43881,70746,71590,67168,67412,68988,62472,68822,55332,68854,68082,52804,68632,68118,67898,69078,75018,60622,69088,67314,65302,47374,65312,47760,42415,65786,60880,72704,56644,54514,66260,68350,72956,71860,59916,70198,55480,65674,65676,64584,67482,32176,60398,65472,63936,67694,71514,63106,67520,67710,60648,68168,66656,58092,68508,65324,70508,58162,51456,48066,67982,66058,66284,46150,52162,67224,57336,60272,69428,32236,73536,74436,72594,65298,69884,70308,62070,71152,64206,63314,67582,48490,71606,72486,72496,73468,55062,69002,74912,49440,58838,73028,71918,71716,59114,67070,73942,71986,71344,59534,69510,69914,69322,59660,67154,67384,69942,67188,74064,73456,69980,74082,62580,64506,69212,68604,71238,74120,55472,60390,65712,73064,70464,64820,71126,69898,70712,68186,68936,65768,72680,73646,72250,68952,60928,51802,66046,70546,67600,68784,67190,65136,66978,66534,46202,69584,68598,67846,69424,68856,70846,61506,69040,71270,67028,70236,67258,66138,55722,64670,66372,69674,59310,61938,64894,68500,72032,71578,67370,51694,71398,66744,69390,65630,61226,49354,61306,66320,67236,66570,71916,68434,66816,70634,74170,53160,63946,70256,67284,71972,73722,64050,56000,65510,66188,73600,71546,51080,56410,67144,65582,67604,69362,59896,70776,67620,59932,68994,49238,65404,63672,68592,67834,72778,69222,64550,69820,71704,73294,71276,55708,57818,70648,72180,65932,74182,65734,64810,61896,68162,63162,74222,63184,58074,69904,70100,70944,70310,62086,64212,64966,71806,48230,67586,68958,73170,62358,75120,72286,66492,73200,72082,73824,73834,57124,69194,69786,61344,71460,57532,71060,73664,59040,67684,72378,71948,60502,55720,67278,65726,69864,74196,71990,74224,64200,71798,51540,73412,63350,69346,48626,67386,63434,73436,66950,74604,67810,71632,67442,69006,72528,67644,46258,49800,67458,73508,60092,74668,71052,52608,72356,73036,59002,55632,68234,64604,65918,63034,46730,69654,73316,66842,70058,68906,69090,65966,67720,57998,69098,63176,67104,65994,67736,68930,68938,68516,70732,58194,66920,72708,72264,69550,66506,66066,59920,72086,64382,67194,73222,71870,69008,74104,65880,70014,68624,70616,67670,72796,73292,61616,55848,68888,67704,68900,40012,68288,67320,42093,69134,71580,48184,62184,59726,54330,71588,62282,71400,66724,44697,67410,73820,67802,70568,66530,61234,66776,69210,67238,58974,67252,57566,74420,74438,68254,60544,68890,63066,47048,69084,75026,65504,65300,66182,61974,66192,70932,64900,63234,70512,67564,54058,68732,70728,47948,58168,68330,74020,63328,74574,62286,65362,71402,65818,68018,51956,59900,75280,66532,67220,69794,70204,65444,50196,57544,68866,46554,67868,69444,68876,64652,67048,69456,72386,66836,69268,73564,60548,37494,73572,72844,55980,65744,70280,67538,71334,74502,66652,60726,70720,67746,51380,60838,48046,74010,69138,67980,67378,69730,71174,65356,69356,67406,66056,61060,68982,67616,72968,71010,65400,65156,62510,65412,59972,68056,65438,70836,50284,66800,66346,69458,66156,64724,67904,66620,70470,53402,55992,64802,53476,60672,56108,66394,69892,72642,60692,73112,69108,68180,70498,64158,60730,66412,65762,59542,69316,69516,47800,59600,56490,60920,67150,48466,66712,66038,48744,54788,68364,73448,72740,71428,72302,68992,69190,68580,62526,67444,58774,59974,72530,67646,68840,65204,70402,70208,58952,61534,72362,50314,74142,65458,63838,50520,73300,66142,64658,69264,67696,66614,69272,73080,71318,67080,67918,69092,50870,53486,70288,73100,66648,70706,64130,69492,59532,60748,67952,72446,71792,65560,73146,58166,71804,71160,72910,70744,70974,65044,74292,70542,70754,67166,69166,72722,65600,66060,65624,68584,73840,68832,65644,73852,74932,67454,63734,67002,69022,67010,55408,71264,70618,74970,65904,66804,71490,69056,65264,73302,66818,52982,67690,64662,67272,72384,73312,71510,70258,67288,64780,66626,65292,59302,53448,60652,68910,73954,67312,75034,74204,67930,74780,65320,53848,68934,73140,65340,66230,65576,64262,68950,71820,72928,73188,51896,71192,69554,67808,61124,68368,73214,65398,72094,59970,72770,46250,62600,65436,67004,65658,64528,65224,74958,69240,65258,69248,68658,68668,67700,64718,63072,72620,66176,68164,53660,72430,63186,67112,73998,64952,67356,68514,66692,63300,54184,43243,67766,70334,71822,70342,65594,65822,70554,69178,54892,58670,67200,74084,73232,69778,70802,71032,74098,63728,67838,68400,73254,62608,72126,55350,65890,68412,65228,62710,61494,73888,70218,73288,60328,68112,59044,64656,73056,61656,72380,70450,73554,72176,72388,65928,46942,74186,59294,71522,74756,65738,73948,72414,57950,70480,66864,71324,68914,67316,71768,51008,71128,74212,53688,72878,69698,75046,74226,66198,68718,73134,42027,71158,68200,67568,67758,73154,66030,68210,67580,72044,67768,70970,62228,65358,63388,54486,68758,65066,67390,69742,72484,69164,51830,74592,72942,69172,67610,66276,62458,72502,58718,66090,67216,66100,74662,46290,69610,74954,68076,73274,32028,68862,67864,67250,74416,68870,64622,72374,62974,60436,57814,50610,34715,68454,71962,71516,61844,67294,72404,57900,72614,69476,73088,67534,59376,69288,68696,66396,61942,71772,71996,53732,40640,72216,68302,71780,69310,67352,74252,67562,72898,67362,68204,67572,59638,70124,69726,69142,56556,68336,66714,62332,70550,66268,64336,48808,70358,73440,72296,56932,74062,62464,72092,54924,71430,59968,72102,68820,71448,69592,73250,72532,60062,64526,74118,62644,58934,71468,73876,68080,63826,72366,69046,68428,60382,68872,74702,64650,67874,70242,74984,67046,69454,46684,65710,69650,65276,68666,73558,67698,72396,73082,71748,68468,69282,74474,65980,73594,58014,71134,70090,66408,73620,64172,56356,58154,65330,67752,68942,68206,74560,72912,67374,69344,54506,68762,44021,68348,69746,71848,65376,73432,61054,65830,65384,63568,68794,68996,67632,69582,58800,67836,57272,69014,68398,66778,63736,74666,65884,73266,62686,58938,70610,67660,73030,69036,65244,62870,70028,69048,62926,32479,65700,63032,65470,50678,59214,74452,71742,65940,68140,74460,75028,70478,68686,64080,68284,60690,66402,70292,62040,63246,69906,73622,72230,56372,58160,69130,70514,64968,67366,67578,67588,67160,72716,64320,72274,69366,54676,70768,72500,66960,68800,66524,66752,69574,49350,72518,69196,72762,70190,57232,66546,65186,69206,65650,67222,68074,72136,73032,66328,71474,74678,67858,72360,66578,71690,74962,65900,68424,71066,74138,65252,68088,70426,62882,69826,72560,69242,71924,66130,68634,74410,65456,70624,73532,73668,67678,72802,69434,72150,66338,68868,71486,74690,46590,65690,70858,67870,73044,61582,69636,72372,66588,69050,71708,74974,50488,68432,71076,74150,65260,70442,73298,62930,67490,69834,66814,69250,68650,71280,74430,32777,65464,70632,73544,73680,67686,70038,72812,67040,69446,72160,55676,68878,71494,74708,65702,68248,70866,73908,67880,70246,67268,69060,71722,74992,68440,71084,74168,65272,73306,67504,69842,72592,59176,66828,69262,71950,66148,68660,71288,74444,73688,70048,72824,60508,67050,66356,71506,74720,68260,70880,73916,70254,73066,67280,66612,69070,71732,75006,68452,71094,74178,65280,68132,70458,67512,69854,72600,59222,71960,68670,71302,74454,65488,70654,63976,67702,72836,67066,69466,72186,68896,65728,68270,70888,73926,67292,69662,72402,69080,71744,75022,65942,68462,71108,68144,73326,69866,72612,69278,71970,68680,71316,74464,65498,70664,73574,64048,72846,69474,72194,68278,70898,67916,70272,73086,67306,66634,71752,75030,68474,71118,74200,68158,73338,63140,67532,69882,69286,71980,66178,68688,74482,73588,73734,64088,70078,72862,67086,71532,74764,65746,68286,70916,73960,64824,67924,70282,73098,69686,72424,66644,75038,65304,70490,73352,67540,66874,66186,74504,65518,70698,73598,64126,70086,69490,72214,56196,66404,71542,74774,65754,68296,70928,73976,70296,61982,67326,72432,71778,71142,73368,63204,67548,69900,72654,66888,69308,72002,53802,71356,74522,65542,70714,73608,73752,70096,72886,67114,69498,72224,74784,47632,70938,73986,67950,70306,62066,67350,69706,72444,66668,69122,75058,71150,74244,68188,73378,63248,67560,69908,66896,72020,66210,68728,71366,74538,65558,70724,73624,73766,67748,72232,66428,71564,74798,65776,68318,70950,74000,67958,70314,73144,62122,69716,72452,66682,69132,71800,75076,74260,65336,73394,69920,72684,66908,69328,66222,68738,71376,74554,65570,70122,67142,69524,72242,68946,65788,68326,70958,74012,64980,67974,70328,69724,72462,66700,69140,71814,75086,68526,71166,74274,65344,70528,73402,63302,72698,69340,66236,68748,71388,74566,65580,70740,73790,64288,70136,72918,69534,72252,66456,68954,71586,74832,65796,68334,74030,65036,70336,73164,67380,69734,72476,58216,69148,71824,75100,68536,71176,74290,68222,70538,73414,67594,69938,59756,66928,69348,72052,74582,65588,70750,73658,73798,64304,67778,70144,72932,69542,66466,71604,74848,68344,70984,74038,67996,70344,73182,66722,71838,75116,66048,68546,71186,74300,70548,73428,63442,67602,69948,69358,72064,66266,68770,65596,70760,73806,70152,61036,67174,56768,66482,71616,74866,65824,70992,74046,65084,68010,70356,73194,62422,67408,69750,72494,58582,66732,71852,75130,68556,71196,74308,65380,70556,73438,69964,72730,69370,72078,71420,74606,65606,70774,73818,64354,67800,70164,72958,67182,69558,72292,56860,68984,71624,74880,71004,74060,65106,73210,67418,69760,71862,75196,68570,71204,74318,65390,70566,63578,69976,66966,69380,54904,68802,74622,65622,70784,73828,67812,70174,69568,57102,66526,71638,74888,65850,71012,65138,68030,70376,62498,69772,72510,66754,66078,71216,74330,65402,70578,73466,63670,67628,69986,72754,59960,66980,68816,71436,74636,70794,73838,64406,67820,70182,72992,67206,72322,69000,71648,74910,65858,68384,71026,74090,65158,68042,70384,73234,69782,72520,66766,69198,71884,68590,71224,65414,70586,73486,67638,69996,72764,69400,72108,66304,68828,74652,65642,70810,73848,64488,67832,70192,73006,69590,72330,66548,71660,65868,68394,71034,65188,68058,70392,73244,69790,66774,69208,71894,68600,71232,74360,65432,70594,73496,63732,70006,72776,60042,67000,69408,72118,66312,65654,70818,73860,67840,70200,73014,61372,69600,72338,69020,74942,68402,71044,74116,68068,73256,62636,67460,69806,72542,58924,66782,69220,71904,68614,71254,74370,65440,70602,73510,63748,67656,72784,67008,69416,72128,55374,68848,71466,74670,65666,70838,73874,67848,72346,69028,71680,65892,68414,71054,74124,65238,70410,67472,69816,72552,66790,69230,66116,71262,74390,65448,70614,73524,63806,67668,70022,72794,60240,69426,72138,65450,73526,73660,63822,70024,67022,72140,55518,71478,74684,46484,65682,70848,73890,64586,70224,73038,69628,57558,69042,71692,74968,65902,68426,71070,65254,68092,70428,67484,69828,72566,59004,66802,69244,71928,66132,68636,71272,70626,73670,67680,70032,72804,60352,69440,72152,55648,66340,71488,74694,65694,68238,70860,73902,67872,73048,67260,69638,69052,71712,74976,65912,71078,74152,65262,68114,70444,67492,69836,72580,59066,69254,71942,68654,71282,65466,73546,73682,63884,67688,70040,72814,69452,72162,66350,68880,71496,74710,68250,70868,73910,67882,70248,73060,61666,67270,69648,72382,66600,71724,74996,65920,68444,71088,65274,68122,70452,73308,63038,67506,69848,66832,71952,66150,68662,71294,74446,65474,70644,73556,73690,70050,72826,60542,67052,69460,72178,66358,71508,74726,68262,70882,73920,67894,73068,61730,69656,72394,57856,69072,75008,65930,71096,74180,65282,68134,70460,73318,69858,72606,59244,66844,66160,68672,71306,74456,65490,70656,73568,73708,63998,70062,67068,69468,72188,55926,74738,46996,65730,68272,70892,73928,64776,70264,69664,66622,69082,71746,75024,65946,71110,74192,65290,68146,73328,67522,69870,66856,69280,66172,68682,74468,65502,70668,73578,67712,70072,72848,60650,72196,66388,68908,71524,74758,65740,68280,70904,73952,70274,67308,72416,66636,71756,75032,71120,74202,68160,70484,73342,72624,66866,66180,70678,73736,67722,70080,67096,69484,72206,68916,71534,74768,65748,70918,73964,67926,69688,72426,75040,65988,68488,71130,74218,65306,68170,70492,67542,69894,59472,66878,69298,68712,71342,74506,65528,73746,67730,70088,72880,60702,67108,66406,68924,74776,65756,70930,73980,64896,67942,70298,73126,69700,58072,69110,75052,65998,68502,71144,74228,65318,68182,73370,67552,66890,72008,66200,68722,71360,74526,65544,70716,73616,73756,64170,67742,70098,72888,67116,69508,72226,66414,68932,71556,74786,65764,68312,70942,73990,73136,69710,58110,66674,69126,75060,66014,65328,68194,70510,73384,69910,72666,66902,69320,72024,66212,68730,71368,74540,70726,73628,73768,67750,70110,60826,67130,69518,72234,66436,68940,71566,74800,47880,65778,68320,70952,74004,67968,70316,69718,72454,66686,75078,68518,74264,65338,70518,73396,63276,69922,72688,66912,69332,72034,66226,68740,71378,74558,43141,70734,73636,73780,67760,60854,69526,72246,56492,68948,74818,65790,68328,70962,74014,67976,70330,73158,72470,58198,66704,71818,75092,51624,66032,68528,71168,74276,65346,68214,70532,73406,69930,72700,66922,69342,72046,68750,71390,74572,73652,73792,70138,72922,60924,67152,69536,72254,66458,68956,74836,65798,74032,67986,70338,73168,67382,72478,75102,66040,68538,65360,73418,63418,67596,69940,72710,66934,69350,72056,66250,68760,74586,44003,65590,73800,64306,67782,72936,69544,72266,68968,74850,68346,70986,74040,65076,70350,73186,67402,69744,71844,75118,66052,68548,71190,74302,73430,63448,69950,59830,72070,54620,74594,70762,67792,70156,72944,61048,67176,69552,66488,68976,71618,74870,65826,68354,70994,74048,65086,68016,73198,62440,69752,66734,69174,71854,75132,51934,68558,71198,74312,70560,63532,67612,69966,72734,66956,69372,72080,66278,71422,65610,70166,72962,67184,69560,66508,68986,71626,74882,49002,65840,71006,65118,68024,70370,73212,67420,69762,72504,69182,71864,75204,66070,71210,74322,65396,73450,63594,69978,72744,66972,69382,68808,74630,70786,73832,70176,72974,61166,67196,69570,71640,74894,65852,68374,71018,74074,70378,73224,67436,69774,72514,66758,69192,71872,66082,74338,70580,67630,69990,72758,66984,69392,66294,71438,74638,65634,70796,70184,72996,69580,72324,66542,71652,65860,71028,74092,73236,62548,69784,72524,66768,69202,71886,66092,71226,74352,65416,73488,67640,69998,72766,59990,66994,69402,74654,70812,64490,70194,73008,67218,72332,66550,69012,71664,49776,68396,74106,65194,68060,70394,69792,71898,66102,68602,71236,74362,65434,70596,73498,70008,69410,72122,66314,68842,71458,74664,65656,70820,73862,67842,70202,67226,69602,72340,66564,71672,74944,65882,68408,71048,65208,68070,70404,73258,67462,69810,66784,71908,68616,71256,65442,70606,73512,63770,67658,70016,72786,60134,69418,72130,66322,74672,46372,65670,70840,69612,72348,66572,69034,71682,74956,65894,68416,71058,74128,65242,70416,73278,67474,69818,66794,69232,66118,68626,74396,67476,72556,66796,69236,71920,52784,66124,68630,71266,74398,73528,73662,70026,72798,60284,67024,69430,72144,66334,68864,71482,74686,65686,68228,70850,73894,64600,67866,73040,69630,66582,71072,74146,65256,68098,70436,67486,71930,52836,66134,65460,70628,73538,73672,67682,70034,72806,67034,69442,72154,55652,46622,65698,68244,70862,73050,61620,67264,69642,72376,66594,65914,68436,71080,74160,68116,70446,67500,69838,72586,69256,71944,66144,68656,71284,65468,70638,73550,73684,63904,70044,72170,66352,71500,74714,70870,73912,67884,70250,73062,66604,69066,71726,75000,65922,68448,71090,74174,68128,70454,63040,67508,69850,72596,59210,66834,71954,53210,71296,74450,65478,73694,72828,67056,69462,55862,66364,74728,65720,68264,70884,73922,67896,73070,61758,69658,57878,66616,69076,71738,75010,68456,71098,68136,70462,67516,69860,72608,66850,69274,71964,66162,68674,71308,74458,65494,70660,73570,73710,64000,67706,70066,72842,69470,72190,66380,68902,71518,74742,68274,70894,67912,70266,67296,69666,72406,57902,65950,71112,74194,68152,70474,73330,63130,67524,66860,71974,68684,71320,70672,73582,67714,70074,72852,69478,72200,66390,74760,65742,68282,70908,67920,70276,73094,69680,72420,66638,69094,71758,50922,71122,70486,73344,67536,59398,66868,53646,68698,71328,74492,40118,73738,70082,67100,69486,72210,66398,71538,74770,65750,68292,70922,73966,70290,73104,67322,69692,72428,66650,69102,71774,75042,65990,68494,65308,68176,70494,67544,69896,72648,66884,69300,71998,53752,74516,40676,65538,70708,73602,73748,64132,67732,72882,60714,67110,69494,72218,71548,47618,65758,68306,73982,73130,67340,69702,72438,66662,69114,71784,75054,66004,68504,71146,68184,70504,73372,67554,72660,66892,69312,72010,66204,68724,71362,74528,65550,73760,67744,72890,67118,72228,66416,74790,65766,68314,73994,67954,69712,72448,66678,69128,71796,75068,66016,68512,71154,74256,68196,73390,72668,59566,66904,72026,66216,71372,74548,73630,73774,70114,72902,67132,69520,72238,66438,71568,74802,65782,68322,70954,74006,67970,70318,73148,62174,69720,72456,66688,69136,75082,51482,66024,68522,71162,74268,70522,73398,66914,69336,71380,70736,73638,73784,67762,70126,60872,67146,69528,66448,71582,65792,70964,64984,67978,70332,73160,62188,69728,72472,66706,69144,75096,51648,66034,71172,74278,65354,70534,73410,72702,66924,72048,54438,68752,71394,65584,73654,73794,67772,70140,60926,69538,72258,74838,65802,68338,70978,74034,70340,69738,72480,58330,66718,69154,71832,75112,66044,68540,71182,74294,70544,73420,72714,66936,72060,74588,65592,70756,73802,64314,67786,70148,72938,60984,69546,72268,66474,71608,74852,70988,74042,65080,70352,72488,58530,66726,69168,66054,68550,74304,70552,67606,69956,72724,59832,66948,69364,72072,54628,68776,71414,65602,70764,73814,64344,70158,72954,67178,56802,68978,71620,74876,68356,71000,74052,65100,70362,62446,69754,72498,69176,71858,75136,66062,68560,71200,74314,70562,67614,69970,72736,66958,69374,66280,74616,65612,70778,64366,70170,72964,69564,72298,66522,71628,74884,65844,71008,65120,68026,70372,69764,72506,66748,69184,71866,66074,68576,71212,70570,63598,67624,72746,69384,66288,68810,71432,65626,70788,64390,67816,70178,72976,61190,67198,69572,72308,74896,68378,71020,68036,70380,73230,67438,69776,72516,66760,71874,66084,68586,71220,74342,65406,70582,73472,63676,69992,72760,66986,69394,72104,66296,71442,74644,70800,67826,70186,72998,72326,66544,69004,71654,74914,65864,68390,71030,74096,68050,70388,73238,67448,72526,66770,69204,71888,66094,71228,74356,65420,70590,73492,63726,67642,70002,66996,69404,72114,66308,68834,71450,74656,65648,70814,73854,70196,73010,69594,72334,66558,71666,74936,65872,71038,74112,65198,68062,70396,73252,67456,72536,71900,66104,74364,70598,73502,67652,70010,72780,69412,72124,66316,68844,70832,73868,73020,67228,69606,72342,57372,69024,71676,74948,68410,71050,68072,70406,67468,66786,69224,71910,66112,71258,74378,73518,63774,70018,72790,60204,67012,69422,72132,66324,71470,74674,46388,65672,70842,73882,67854,70212,61474,69614,72350,66574,71686,65896,68418,74130,70418,73280,66576,74960,50240,65898,68420,71062,74136,65248,68086,70422,73286,67478,69824,72558,66798,71922,66128,74404,65454,70622,73530,67676,72800,69432,72146,66336,71484,74688,65688,68232,70854,73896,64602,70232,73042,61574,67256,69632,72368,57606,66586,71706,74972,50480,65906,68430,71074,74148,68106,70438,73296,67488,69832,66812,71936,52902,66136,68648,71278,74428,65462,70630,73674,63864,70036,72808,72158,55666,66344,71492,74706,68246,70864,73906,67878,70244,73054,61634,67266,69644,57718,66596,69058,71718,74990,65916,68438,71082,74162,70448,67502,69840,72588,66824,69258,66146,71286,74440,70640,73552,73686,67692,70046,72820,72172,66354,68884,71502,74718,70878,73914,64666,67886,70252,66606,69068,75004,65926,68450,74176,65278,68130,70456,63052,67510,69852,72598,66154,65482,70652,73696,70056,72830,67064,69464,72184,66370,68894,71512,74730,68266,70886,73924,70260,73076,61818,67290,69660,72400,57888,66618,50766,68460,74184,73324,67518,72610,66852,69276,71966,68678,71312,65496,70662,73716,67708,70068,67074,69472,72192,66384,68904,71520,74746,65736,68276,64794,67914,70268,67298,69672,72408,66632,71750,68470,71116,68154,73332,67530,69880,59306,69284,71976,71322,74478,65506,70674,73584,73730,67718,70076,72860,69480,72202,56064,66392,68912,71528,74762,70914,73958,67922,73096,69684,72422,57994,66642,69096,71764,75036,65982,74208,70488,69888,72634,66870,66184,68706,65516,70696,73596,67726,70084,72876,67102,69488,72212,68920,71540,74772,65752,70926,73974,64886,67932,73110,61976,67324,69696,69106,71776,75044,71140,68178,70496,73364,67546,72652,66886,69306,72000,53800,66196,68716,71348,74520,65540,73604,73750,67734,72884,72220,71550,74782,65760,68308,70936,73984,64920,67948,70304,73132,69704,72442,66664,69116,71788,75056,66006,68506,71148,74242,65322,70506,73374,67556,72662,59540,66894,69314,68726,71364,74534,65556,73764,70102,72894,60788,67122,69512,66424,74792,68316,70946,70312,73142,62106,72450,75074,66018,71156,74258,68198,73392,63262,67566,69916,59594,66906,69326,72030,66218,68734,71374,74550,65568,70730,73632,73776,64216,67754,70116,72904,67138,69522,72240,66440,68944,71570,74804,68324,70956,67972,73152,62176,69722,72460,71812,75084,68524,71164,65342,68208,70524,73400,69926,72696,66918,69338,72042,68746,71384,74562,65578,70738,73788,64278,70134,72914,67148,69530,66450,71584,74826,65794,70968,74028,73162,62216,72474,66710,69146,75098,66036,68534,74288,68220,70536,69936,59738,72050,71396,74580,65586,70748,73656,73796,67776,70142,72930,69540,72260,66462,71592,65806,68340,70980,74036,65058,67994,73178,69740,72482,66720,69162,71834,75114,68542,71184,74298,65364,73426,69944,59790,72062,68768,71404,74590,70758,73804,67788,70150,72940,67170,69548,66480,68972,71614,74864,70990,74044,68004,70354,73192,62384,69748,72492,66728,69170,71850,75128,68554,71194,74306,65378,63506,67608,69958,59884,72076,66274,71416,65604,64350,67796,70160,69556,66504,71622,74878,71002,74056,65104,68020,70364,73202,67414,69758,75142,66064,68562,71202,74316,65388,70564,73446,63576,69974,72738,72084,71426,74618,45116,65618,70780,73826,64380,70172,69566,72300,57072,74886,49094,65848,68370,74066,68028,70374,73220,69768,72508,69188,71868,66076,71214,74328,70572,73462,63646,67626,69982,72752,72096,66290,68814,71434,74634,73836,67818,70180,72986,61212,72318,71644,74900,68382,71022,68038,70382,66764,66086,68588,71222,74346,70584,73476,63710,67634,69994,69398,72106,66300,71444,74650,65640,73846,73002,67214,72328,71656,74918,49534,65866,68392,70390,73242,62582,67450,69788,66772,71892,66098,71230,74358,65422,70592,70004,72774,66998,69406,72116,66310,71452,70816,73856,64522,73012,69598,72336,66560,69016,74938,71040,74114,65200,68064,70400,69802,72538,58912,66780,69218,71902,66106,68610,74366,70600,63740,67654,70012,72782,67006,69414,66318,71462,73872,70206,73022,61452,67232,69608,72344,57378,66568,69026,71678,74950,74122,70408,73270,69814,72550,58946,66788,69228,71912,66114,68622,71260,74382,65446,70612,73522,67666,70020,72792,67014,66326,71472,74676,46434,70844,73886,67856,70214,67246,69622)
		GROUP BY r.User_ID,
			u.User_Name,u.User_Sex ,u.User_Phone,u.User_Mail,
			u.User_Address,datetime;
		'''
		return sql;


	def queryActiveUser(self):
		sql=self.createSQL()
		cur = self.conn.cursor()
		aa=cur.execute(sql)
		info = cur.fetchmany(aa)

		if info:
			content=self.createHtmlContent();
			trs=''
			now_time = datetime.datetime.now()
			yes_time = now_time + datetime.timedelta(days=-1)
			yes_time_nyr = yes_time.strftime("%Y年%m月%d日")
			head=yes_time_nyr+'全天登录的老用户列表'
			for ii in info:
				tr='<tr><td>'+str(ii[1])+'</td>'
				tr+='<td>'+str(ii[2])+'</td>'
				tr+='<td>'+str(ii[3])+'</td>'
				tr+='<td>'+str(ii[4])+'</td>'
				tr+='<td>'+str(ii[5])+'</td>'
				tr+='<td>'+str(ii[6])+'</td>'
				tr+='<td>'+str(ii[7])+'</td></tr>'
				trs+=tr

			content=content% (head,trs)
			from_email = 'info@mhealth365.com'
			passwd = 'mHealth365Dev'
			to_email = ['jiangfengwei_2@126.com']
			project = time.strftime("%Y年%m月%d日")+'老客户激活'
			# print(content)
			mymail.myMail(from_email,passwd,to_email,project,content)

		cur.close()
		self.conn.commit()
		self.conn.close()


if __name__ == '__main__':
	try:
		au = ActiveUser()
		# print(au.conn)
		au.queryActiveUser()
	except Exception as e:
		print(e)
